<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Animated CIM Markers</title>
    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.26/"></script>

    <script>
      require(["esri/Map", "esri/views/MapView", "esri/layers/FeatureLayer", "esri/layers/VectorTileLayer", "esri/Basemap"], (Map, MapView, FeatureLayer, VectorTileLayer, Basemap) => {
        const star = [];

        for (let i = 0; i <= 10; i++) {
          const radius = i % 2 ? 2 : 3;
          const radians = 2 * Math.PI * i / 10;

          star.push([
            radius * Math.sin(radians),
            radius * Math.cos(radians)
          ]);
        }

        const featureLayer = new FeatureLayer({
          effect: "bloom(0.5, 0.1px, 15%)",
          renderer: {
            type: "simple",
            symbol: {
              type: "cim",
              data: {
                type: "CIMSymbolReference",
                symbol: {
                  type: "CIMLineSymbol",
                  symbolLayers: [
                    {
                      "type": "CIMPictureMarker",
                      "enable": true,
                      "anchorPointUnits": "Relative",
                      "dominantSizeAxis3D": "Y",
                      "size": 24.75,
                      "billboardMode3D": "FaceNearPlane",
                      "markerPlacement": {
                        "type": "CIMMarkerPlacementAlongLineSameSize",
                        "placePerPart": true,
                        "angleToLine": false,
                        "endings": "NoConstraint",
                        "placementTemplate": [
                          15
                        ]
                      },
                      "invertBackfaceTexture": true,
                      "scaleX": 1,
                      "textureFilter": "Picture",
                      "tintColor": [
                        255,
                        255,
                        255,
                        255
                      ],
                      "url": "images/fire.gif",
                      animatedSymbolProperties: {
                        primitiveName: "Transfer"
                      }
                    }
                  ]
                },
                primitiveOverrides: [
                  {
                    type: "CIMPrimitiveOverride",
                    primitiveName: "Transfer",
                    propertyName: "Duration",
                    valueExpressionInfo: {
                      type: "CIMExpressionInfo",
                      expression: "1 / (0.1 + $feature.TransferRate)"
                    }
                  }
                ]
              }
            }
          },
          source: [
            {
              geometry: {
                type: "polyline",
                paths: [
                  [
                    [10.7522, 59.9139],
                    [11.7522, 58.9139],
                    [13.7522, 57.9139],
                    [14.7522, 55.9139],
                    [10.7522, 53.9139]
                  ]
                ],
                spatialReference: {
                  wkid: 4326
                }
              },
              attributes: {
                OID: 1,
                TransferRate: 1,
                Name: "Some name..."
              }
            },
          ],
          objectIdField: "OID",
          fields: [
            {
              name: "TransferRate",
              type: "double"
            },
            {
              name: "StartDelay",
              type: "double"
            }
          ]
        });

        const basemap = new Basemap({
          baseLayers: [
            new VectorTileLayer({
              url: "https://www.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json"
            })
          ]
        });

        const map = new Map({
          basemap,
          layers: [featureLayer]
        });

        const view = new MapView({
          container: "viewDiv",
          map: map,
          zoom: 4,
          center: [15, 60]
        });
      });
    </script>
  </head>

  <body>
    <div id="viewDiv"></div>
  </body>
</html>