<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Animated CIM Markers</title>
    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.26/"></script>

    <script>
      require(["esri/Map", "esri/views/MapView", "esri/layers/FeatureLayer", "esri/layers/VectorTileLayer", "esri/layers/TileLayer", "esri/Basemap", "esri/Graphic"], (Map, MapView, FeatureLayer, VectorTileLayer, TileLayer, Basemap, Graphic) => {
        const countries = new FeatureLayer({
          url: "https://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/World_Countries_(Generalized)/FeatureServer"
        });

        const outlineSymbol = {
          type: "cim",
          data: {
            type: "CIMSymbolReference",
            symbol: {
              type: "CIMLineSymbol",
              symbolLayers: [
                {
                  "type": "CIMPictureMarker",
                  "enable": true,
                  "anchorPointUnits": "Relative",
                  "dominantSizeAxis3D": "Y",
                  "size": 8,
                  "billboardMode3D": "FaceNearPlane",
                  "markerPlacement": {
                    "type": "CIMMarkerPlacementAlongLineSameSize",
                    "placePerPart": true,
                    "angleToLine": true,
                    "endings": "NoConstraint",
                    "placementTemplate": [
                      1
                    ]
                  },
                  "invertBackfaceTexture": true,
                  "scaleX": 1,
                  "textureFilter": "Picture",
                  "tintColor": [
                    210,
                    230,
                    250,
                    40
                  ],
                  "url": "images/pulse.gif"
                }
              ]
            }
          }
        };

        const fillSymbol = {
          type: "simple-fill",
          color: "rgba(255, 255, 255, 0.2)"
        };

        async function highlight(feature) {
          const { geometry } = feature;

          const fill = new Graphic({
            geometry,
            symbol: fillSymbol
          })
          
          const outline = new Graphic({
            geometry,
            symbol: outlineSymbol
          });

          view.graphics.removeAll();
          view.graphics.addMany([fill, outline]);
        }

        const imageryLayer = new TileLayer({
          url: "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",
          effect: "brightness(40%)"
        });

        const vectorTileLayer = new VectorTileLayer({
          opacity: 0.7,
          url: "https://www.arcgis.com/sharing/rest/content/items/c11ce4f7801740b2905eb03ddc963ac8/resources/styles/root.json"
        });

        const basemap = new Basemap({
          baseLayers: [
            imageryLayer,
            vectorTileLayer
          ]
        });

        const map = new Map({
          basemap
        });

        const view = new MapView({
          container: "viewDiv",
          map: map,
          zoom: 6,
          center: [8.2275, 46.8182]
        });

        view.on("click", () => {
          const query = countries.createQuery();
          query.where = "COUNTRY='Switzerland'";
          query.returnGeometry = true;
          countries.queryFeatures(query).then((featureSet) => {
            highlight(featureSet.features[0]);
          });
        });
      });
    </script>
  </head>

  <body>
    <div id="viewDiv"></div>
  </body>
</html>